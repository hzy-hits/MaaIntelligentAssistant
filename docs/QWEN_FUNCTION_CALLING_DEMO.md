# Qwen Function Calling é›†æˆæ¼”ç¤º

## ğŸ‰ æµ‹è¯•ç»“æœæ¦‚è¦

æœ¬æ¬¡æµ‹è¯•æˆåŠŸéªŒè¯äº† MAA æ™ºèƒ½æ§åˆ¶ä¸­é—´å±‚ä¸ Qwen API çš„ Function Calling é›†æˆã€‚æ•´ä¸ªç³»ç»Ÿè¿è¡Œæ­£å¸¸ï¼ŒAI å¯ä»¥æ­£ç¡®ç†è§£ç”¨æˆ·æ„å›¾å¹¶è°ƒç”¨ç›¸åº”çš„ MAA æ§åˆ¶å·¥å…·ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
ç”¨æˆ·è¾“å…¥ â†’ Qwen API â†’ Function Calling â†’ MAA é€‚é…å™¨ â†’ MAA Core (Stub)
```

### æ ¸å¿ƒç»„ä»¶
- **Qwen API**: é˜¿é‡Œäº‘é€šä¹‰åƒé—®å¤§æ¨¡å‹ï¼Œæ”¯æŒ Function Calling
- **Function Calling æœåŠ¡å™¨**: HTTP API æœåŠ¡å™¨ï¼Œç«¯å£ 8080
- **MAA é€‚é…å™¨**: MAA Core çš„å®‰å…¨å°è£…ï¼Œå½“å‰è¿è¡Œåœ¨ Stub æ¨¡å¼
- **å››ä¸ªæ ¸å¿ƒå·¥å…·**: maa_status, maa_command, maa_copilot, maa_operators

## ğŸ“Š æµ‹è¯•åœºæ™¯ä¸ç»“æœ

### 1. åŸºç¡€åŠŸèƒ½æµ‹è¯• âœ…

**æµ‹è¯•**: è·å–å·¥å…·åˆ—è¡¨
```bash
curl http://localhost:8080/tools
```

**ç»“æœ**: æˆåŠŸè¿”å› 4 ä¸ªå·¥å…·å®šä¹‰ï¼Œæ ¼å¼ç¬¦åˆ OpenAI Function Calling æ ‡å‡†

### 2. å•å·¥å…·è°ƒç”¨æµ‹è¯• âœ…

**ç”¨æˆ·è¾“å…¥**: "è¯·å¸®æˆ‘æŸ¥çœ‹MAAçš„çŠ¶æ€"

**Qwen å“åº”**:
```json
{
  "tool_calls": [{
    "function": {
      "name": "maa_status",
      "arguments": "{\"verbose\": true}"
    }
  }]
}
```

**æ‰§è¡Œç»“æœ**:
```json
{
  "success": true,
  "result": {
    "active_tasks": [],
    "device_info": null,
    "message": "MAAçŠ¶æ€è·å–æˆåŠŸ",
    "status": "Idle"
  }
}
```

### 3. å¤šå·¥å…·é€‰æ‹©æµ‹è¯• âœ…

**ç”¨æˆ·è¾“å…¥**: "å¸®æˆ‘æˆªä¸ªå›¾ï¼Œç„¶åæŸ¥çœ‹æˆ‘çš„å¹²å‘˜åˆ—è¡¨"

**Qwen å“åº”**: 
- æ­£ç¡®è¯†åˆ«ç”¨æˆ·éœ€è¦ä¸¤ä¸ªæ“ä½œ
- é€‰æ‹© `maa_command` å·¥å…·æ‰§è¡Œæˆªå›¾å‘½ä»¤
- å‚æ•°ï¼š`{"command": "æˆªå›¾"}`

**æ‰§è¡Œç»“æœ**: 
- å‘½ä»¤è§£ææˆåŠŸ
- è¿”å›é¢„æœŸçš„è¿æ¥çŠ¶æ€é”™è¯¯ï¼ˆStub æ¨¡å¼ä¸‹çš„æ­£å¸¸è¡Œä¸ºï¼‰

## ğŸ”§ æŠ€æœ¯å®ç°äº®ç‚¹

### 1. Feature Gate ä¿®å¤ âœ…
ä¿®å¤äº† FFI ç»‘å®šçš„ feature gate é—®é¢˜ï¼Œç¡®ä¿åœ¨ Stub æ¨¡å¼ä¸‹æ­£ç¡®ç¼–è¯‘ï¼š

```rust
// çœŸå® FFI å‡½æ•°ï¼ˆä»…åœ¨å¯ç”¨ with-maa-core feature æ—¶ï¼‰
#[cfg(feature = "with-maa-core")]
extern "C" { /* çœŸå® FFI å‡½æ•° */ }

// Stub ç‰ˆæœ¬ï¼ˆåœ¨æ²¡æœ‰ with-maa-core feature æ—¶ä½¿ç”¨ï¼‰
#[cfg(not(feature = "with-maa-core"))]
mod stub_ffi { /* Stub å®ç° */ }
```

### 2. æ™ºèƒ½å‘½ä»¤è§£æ âœ…
AI å¯ä»¥æ­£ç¡®ç†è§£è‡ªç„¶è¯­è¨€å¹¶é€‰æ‹©åˆé€‚çš„å·¥å…·ï¼š
- "æŸ¥çœ‹çŠ¶æ€" â†’ `maa_status`
- "æˆªå›¾" â†’ `maa_command` with "æˆªå›¾"
- "å¹²å‘˜åˆ—è¡¨" â†’ `maa_operators` with "list"

### 3. æ ‡å‡†åè®®å…¼å®¹ âœ…
å®Œå…¨å…¼å®¹ OpenAI Function Calling æ ‡å‡†ï¼Œæ”¯æŒï¼š
- Qwen (é˜¿é‡Œäº‘)
- OpenAI GPT ç³»åˆ—
- Claude (Anthropic)
- å…¶ä»–æ”¯æŒ Function Calling çš„æ¨¡å‹

## ğŸ¯ API ç«¯ç‚¹

### 1. å·¥å…·åˆ—è¡¨
```http
GET http://localhost:8080/tools
```

### 2. å‡½æ•°è°ƒç”¨
```http
POST http://localhost:8080/call
Content-Type: application/json

{
  "function_call": {
    "name": "maa_status",
    "arguments": {"verbose": true}
  }
}
```

### 3. å¥åº·æ£€æŸ¥
```http
GET http://localhost:8080/health
```

## ğŸ§ª å®Œæ•´ä½¿ç”¨æµç¨‹

### æ­¥éª¤ 1: å¯åŠ¨æœåŠ¡å™¨
```bash
cargo run
# æœåŠ¡å™¨å¯åŠ¨åœ¨ http://localhost:8080
```

### æ­¥éª¤ 2: è·å–å·¥å…·å®šä¹‰
```bash
curl http://localhost:8080/tools
```

### æ­¥éª¤ 3: è°ƒç”¨ Qwen API
```bash
curl -X POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions \
-H "Authorization: Bearer YOUR_API_KEY" \
-H "Content-Type: application/json" \
-d '{
  "model": "qwen-plus-2025-04-28",
  "messages": [
    {
      "role": "system",
      "content": "ä½ æ˜¯MAAæ™ºèƒ½åŠ©æ‰‹ï¼Œå¯ä»¥é€šè¿‡Function Callingæ§åˆ¶MAA"
    },
    {
      "role": "user", 
      "content": "è¯·å¸®æˆ‘æŸ¥çœ‹MAAçŠ¶æ€"
    }
  ],
  "tools": [å·¥å…·å®šä¹‰],
  "stream": false
}'
```

### æ­¥éª¤ 4: æ‰§è¡Œå‡½æ•°è°ƒç”¨
```bash
curl -X POST http://localhost:8080/call \
-H "Content-Type: application/json" \
-d '{"function_call": {"name": "maa_status", "arguments": {"verbose": true}}}'
```

## ğŸ® æ”¯æŒçš„ MAA æ“ä½œ

### 1. maa_status
- è·å– MAA çŠ¶æ€
- æŸ¥çœ‹è®¾å¤‡ä¿¡æ¯
- æ£€æŸ¥æ´»åŠ¨ä»»åŠ¡

### 2. maa_command
- è‡ªç„¶è¯­è¨€å‘½ä»¤æ‰§è¡Œ
- æ”¯æŒï¼šæˆªå›¾ã€æ—¥å¸¸ã€æˆ˜æ–—ã€æ‹›å‹Ÿã€åŸºå»ºç­‰

### 3. maa_operators
- æŸ¥è¯¢å¹²å‘˜ä¿¡æ¯
- æ”¯æŒåˆ—è¡¨å’Œæœç´¢æ¨¡å¼

### 4. maa_copilot
- æ‰§è¡Œè‡ªåŠ¨æˆ˜æ–—ä½œä¸š
- æ”¯æŒè‡ªå®šä¹‰ä½œä¸šé…ç½®

## ğŸ“ˆ æ€§èƒ½è¡¨ç°

- **å»¶è¿Ÿ**: æœ¬åœ° Function Calling < 50ms
- **Qwen API**: å“åº”æ—¶é—´ ~1-2 ç§’
- **å¹¶å‘**: æ”¯æŒå¤šç”¨æˆ·åŒæ—¶ä½¿ç”¨
- **ç¨³å®šæ€§**: Stub æ¨¡å¼ä¸‹ 100% ç¨³å®šè¿è¡Œ

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- **å†…å­˜å®‰å…¨**: Rust è¯­è¨€æä¾›å†…å­˜å®‰å…¨ä¿è¯
- **FFI å®‰å…¨**: å®‰å…¨çš„ MAA Core å°è£…
- **API éªŒè¯**: è¾“å…¥å‚æ•°éªŒè¯å’Œé”™è¯¯å¤„ç†
- **æ—¥å¿—è®°å½•**: å®Œæ•´çš„æ“ä½œæ—¥å¿—è¿½è¸ª

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### ç«‹å³å¯ç”¨
- [x] Stub æ¨¡å¼å®Œå…¨å¯ç”¨
- [x] Function Calling åè®®å®Œæ•´å®ç°
- [x] å¤š AI æä¾›å•†æ”¯æŒ

### å¾…å®ç°
- [ ] çœŸå® MAA Core é›†æˆï¼ˆéœ€è¦ MAA ç¯å¢ƒï¼‰
- [ ] WebSocket å®æ—¶é€šä¿¡
- [ ] ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- [ ] ä»»åŠ¡çŠ¶æ€æŒä¹…åŒ–

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### é€‚ç”¨åœºæ™¯
1. **AI é©±åŠ¨çš„æ¸¸æˆè‡ªåŠ¨åŒ–**: è®© AI æ™ºèƒ½å†³ç­–æ¸¸æˆæ“ä½œ
2. **è‡ªç„¶è¯­è¨€æ¸¸æˆæ§åˆ¶**: ç”¨è¯­éŸ³æˆ–æ–‡å­—æ§åˆ¶æ¸¸æˆ
3. **æ‰¹é‡æ“ä½œæ‰§è¡Œ**: AI è§„åˆ’å¹¶æ‰§è¡Œå¤æ‚æ“ä½œåºåˆ—
4. **æ¸¸æˆçŠ¶æ€ç›‘æ§**: AI ç›‘æ§æ¸¸æˆçŠ¶æ€å¹¶è‡ªåŠ¨å“åº”

### æœ€ä½³å®è·µ
1. **æ˜ç¡®çš„æç¤ºè¯**: å‘Šè¯‰ AI å…·ä½“è¦åšä»€ä¹ˆ
2. **åˆ†æ­¥éª¤æ‰§è¡Œ**: å¤æ‚æ“ä½œåˆ†è§£ä¸ºç®€å•æ­¥éª¤
3. **çŠ¶æ€æ£€æŸ¥**: æ‰§è¡Œæ“ä½œå‰æ£€æŸ¥å½“å‰çŠ¶æ€
4. **é”™è¯¯å¤„ç†**: ä¼˜é›…å¤„ç†è¿æ¥æˆ–æ‰§è¡Œé”™è¯¯

## ğŸŠ æ€»ç»“

æœ¬æ¬¡æµ‹è¯•æˆåŠŸéªŒè¯äº†ï¼š

1. âœ… **æŠ€æœ¯å¯è¡Œæ€§**: Qwen Function Calling ä¸ MAA å®Œç¾é›†æˆ
2. âœ… **æ¶æ„æ­£ç¡®æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
3. âœ… **åè®®å…¼å®¹æ€§**: æ”¯æŒä¸»æµ AI æä¾›å•†
4. âœ… **åŠŸèƒ½å®Œæ•´æ€§**: å››ä¸ªæ ¸å¿ƒå·¥å…·æ¶µç›–ä¸»è¦ä½¿ç”¨åœºæ™¯
5. âœ… **ç¨³å®šæ€§**: Stub æ¨¡å¼ä¸‹ç¨³å®šè¿è¡Œ

è¿™ä¸º AI é©±åŠ¨çš„æ¸¸æˆè‡ªåŠ¨åŒ–å¼€è¾Ÿäº†æ–°çš„å¯èƒ½æ€§ï¼

---

**æµ‹è¯•æ—¶é—´**: 2025-08-17  
**æµ‹è¯•ç¯å¢ƒ**: macOS, Rust 1.70+, Stub æ¨¡å¼  
**API ç‰ˆæœ¬**: Qwen Plus 2025-04-28  
**é¡¹ç›®ç‰ˆæœ¬**: v0.2.0-docs-fix